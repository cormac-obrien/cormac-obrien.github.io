<!doctype html>
<html>
 <head>
  <title>GSoC 2015: QEMU OS 9 Support</title>
  <link rel="stylesheet"
        type="text/css"
        href="http://c-obrien.org/style.css" />
 </head>

 <body>
  <h1>GSoC 2015</h1>
  <h2>Adding Support for Mac OS 9 to QEMU</h2>

  <hr />

  <h3>Overview</h3>
  <p>As of version 2.2.1, QEMU does not support emulation of a machine running
     Mac OS 9. This GSoC project aims to implement support for OS 9.</p>

  <h3>Status</h3>

  <h4>2015.03.29</h4>
  <p>A more thorough examination of the code calculating the size of the boot
     script shows that the file size is actually being calculated correctly,
     but OS 9 expects the host firmware to stop loading at the ASCII EOT (0x04) 
     immediately following the script.  It's not quite clear why the file is
     padded out to 2.7 MB, but it may have to do with the Adler-32 checksum,
     which takes the file size as a parameter.<p>

  <h4>2015.03.28</h4>
  <p>The script fails because it expects the host firmware to implement a word
     <code>adler32</code>, which I can only assume is an Adler-32 checksum.
     It's not entirely clear how OS 9 expects it to be implemented, but it
     should be fairly close to the reference implementation (zlib).</p>

  <h4>2015.03.27</h4>
  <p>I've confirmed that OpenBIOS is able to find the boot script, and by
     calculating the script size with <code>strlen()</code> instead of the
     default method it successfully loads and begins execution (this is a
     temporary workaround). Unfortunately the script still leads to a "No valid
     state" error, which most likely means that the script fails to execute
     properly.</p>

  <h4>2015.03.26</h4>
  <p>The out-of-memory error occurs in <code>bootinfo_init_program</code> while
     trying to allocate memory to load the boot script. The script is only
     about 80 lines long, so it would appear that OpenBIOS is incorrectly
     calculating the size of the boot script.</p>

  <h4>2015.03.25</h4>
  <p>OpenBIOS fails to boot from the OS 9.2.2 install ISO. This appears to be
  the result of an out-of-memory error. The launch command given is</p>
  <pre><code>$ qemu-system-ppc -m 256 -cdrom os9.iso -boot d</code></pre>

  <h3>References</h3>
  <ul>
   <li><a href=http://docs.oracle.com/cd/E19253-01/806-1380-10/>FCode Specification</a></li>
  </ul>

  <h3>Acknowledgments</h3>
  <ul>
   <li>Alexander Graf</li>
   <li>Mark Cave-Ayland</li>
  </ul>

 </body>
</html>
